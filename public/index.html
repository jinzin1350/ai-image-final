<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุนฺฉุงุณ ูุฏ ุจุง ููุด ูุตููุน</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>๐ธ ุนฺฉุงุณ ูุฏ ุจุง ููุด ูุตููุน</h1>
                <p class="subtitle">ุชููุฏ ุนฺฉุณโูุง ุญุฑููโุง ูุญุตูู ุฏุฑ ฺูุฏ ุซุงูู</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <a href="/profile.html" class="gallery-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">๐ค ูพุฑููุงู ูู</a>
                <a href="/gallery.html" class="gallery-btn">๐ผ๏ธ ฺฏุงูุฑ ุชุตุงูุฑ ูู</a>
                <button onclick="handleLogout()" class="gallery-btn" style="background: #ef4444; cursor: pointer; border: none;">๐ช ุฎุฑูุฌ</button>
            </div>
        </header>

        <div class="main-content">
            <!-- ุจุฎุด ุงูุชุฎุงุจ ุญุงูุช -->
            <section class="selection-section mode-selection">
                <div class="section-header">
                    <h2>๐ฏ ุฎุฏูุงุช ุนฺฉุงุณ ููุด ูุตููุน</h2>
                    <p class="section-description">ุจุง ุชฺฉููููฺ ูพุดุฑูุชู AIุ ุนฺฉุณโูุง ุญุฑููโุง ูุญุตููุงุช ุฎูุฏ ุฑุง ุฏุฑ ฺูุฏ ุซุงูู ุชููุฏ ฺฉูุฏ</p>
                </div>
                <div class="mode-selector">
                    <a href="/complete-outfit.html" class="mode-card" style="text-decoration: none; color: inherit;">
                        <div class="mode-badge">ูุญุจูุจโุชุฑู</div>
                        <div class="mode-icon">๐</div>
                        <div class="mode-title">ุนฺฉุงุณ ุงุณุชุงู ฺฉุงูู</div>
                        <div class="mode-description">ุนฺฉุณ ูุฏู ุจุง ูุจุงุณ ฺฉุงูู + ุญุฌุงุจ + ุงฺฉุณุณูุฑ</div>
                        <div class="mode-features">
                            <span class="feature-tag">โ ูุฏูโูุง ูุชููุน</span>
                            <span class="feature-tag">โ ูุจุงุณโูุง ฺูุฏุชุง</span>
                            <span class="feature-tag">โ ุงูุชุฎุงุจ ุญุฌุงุจ</span>
                        </div>
                        <a href="/services/complete-outfit.html" onclick="event.stopPropagation();" style="display: inline-block; margin-top: 12px; color: #667eea; text-decoration: none; font-weight: 500; font-size: 0.9375rem;">ุงุทูุงุนุงุช ุจุดุชุฑ โ</a>
                    </a>

                    <a href="/accessories-only.html" class="mode-card" style="text-decoration: none; color: inherit;">
                        <div class="mode-icon">๐</div>
                        <div class="mode-title">ุนฺฉุงุณ ุงฺฉุณุณูุฑ ูุญุตูู</div>
                        <div class="mode-description">ุนฺฉุณ ุญุฑููโุง ฺฉูุ ฺฉูุดุ ุณุงุนุชุ ุฌูุงูุฑุงุช</div>
                        <div class="mode-features">
                            <span class="feature-tag">โ ูุฏู ุฏุณุช ุทุจุน</span>
                            <span class="feature-tag">โ ุตุญููโูุง ูุงูุน</span>
                            <span class="feature-tag">โ ุจุฏูู ูุชูุดุงูพ</span>
                        </div>
                        <a href="/services/accessories-only.html" onclick="event.stopPropagation();" style="display: inline-block; margin-top: 12px; color: #667eea; text-decoration: none; font-weight: 500; font-size: 0.9375rem;">ุงุทูุงุนุงุช ุจุดุชุฑ โ</a>
                    </a>

                    <a href="/color-collection.html" class="mode-card" style="text-decoration: none; color: inherit;">
                        <div class="mode-icon">๐จ</div>
                        <div class="mode-title">ููุงุด ฺฉุงูฺฉุดู ุฑูฺฏ</div>
                        <div class="mode-description">ููุงุด ููู ุฑูฺฏโูุง ูุญุตูู ุฏุฑ ฺฉ ุนฺฉุณ</div>
                        <div class="mode-features">
                            <span class="feature-tag">โ ฺูุฏ ุฑูฺฏ</span>
                            <span class="feature-tag">โ ฺุฏูุงู ุฒุจุง</span>
                            <span class="feature-tag">โ ุขูุงุฏู ูุฑูุด</span>
                        </div>
                        <a href="/services/color-collection.html" onclick="event.stopPropagation();" style="display: inline-block; margin-top: 12px; color: #667eea; text-decoration: none; font-weight: 500; font-size: 0.9375rem;">ุงุทูุงุนุงุช ุจุดุชุฑ โ</a>
                    </a>

                    <a href="/flat-lay.html" class="mode-card" style="text-decoration: none; color: inherit;">
                        <div class="mode-badge new-badge">ูพุฑุทุฑูุฏุงุฑ</div>
                        <div class="mode-icon">๐ธ</div>
                        <div class="mode-title">ุนฺฉุงุณ Flat Lay ุญุฑููโุง</div>
                        <div class="mode-description">ุนฺฉุณ ุงุฒ ุจุงูุง ุจุง ฺุฏูุงู ููุฑ ูุญุตููุงุช</div>
                        <div class="mode-features">
                            <span class="feature-tag">โ 4 ููุน ฺุฏูุงู</span>
                            <span class="feature-tag">โ ุฏุฏ overhead</span>
                            <span class="feature-tag">โ ุงุณุชุงู ุงูุณุชุงฺฏุฑุงู</span>
                        </div>
                        <a href="/services/flat-lay.html" onclick="event.stopPropagation();" style="display: inline-block; margin-top: 12px; color: #667eea; text-decoration: none; font-weight: 500; font-size: 0.9375rem;">ุงุทูุงุนุงุช ุจุดุชุฑ โ</a>
                    </a>

                    <a href="/scene-recreation.html" class="mode-card" style="text-decoration: none; color: inherit;">
                        <div class="mode-badge new-badge">ุฌุฏุฏ</div>
                        <div class="mode-icon">๐ฌ</div>
                        <div class="mode-title">ุงููุงู ุงุฒ ุนฺฉุณ ูุฑุฌุน</div>
                        <div class="mode-description">ุชููุฏ ุนฺฉุณ ูุดุงุจู ุจุง ุชุฑฺฉุจ ูุฏู ู ูุจุงุณ ุดูุง</div>
                        <div class="mode-features">
                            <span class="feature-tag">โ ฺฉูพ ุงุณุชุงู</span>
                            <span class="feature-tag">โ ุชุญูู AI</span>
                            <span class="feature-tag">โ ููุฑูพุฑุฏุงุฒ ูุดุงุจู</span>
                        </div>
                        <a href="/services/scene-recreation.html" onclick="event.stopPropagation();" style="display: inline-block; margin-top: 12px; color: #667eea; text-decoration: none; font-weight: 500; font-size: 0.9375rem;">ุงุทูุงุนุงุช ุจุดุชุฑ โ</a>
                    </a>

                    <a href="/style-transfer.html" class="mode-card" style="text-decoration: none; color: inherit;">
                        <div class="mode-badge new-badge">โจ ุฌุฏุฏ</div>
                        <div class="mode-icon">๐จ</div>
                        <div class="mode-title">ุงูุชูุงู ุงุณุชุงู</div>
                        <div class="mode-description">ุงูุชูุงู ูุถุง ู ุญุงู ุนฺฉุณโูุง ุงุณุชุงู ุจู ุนฺฉุณ ุงุตู</div>
                        <div class="mode-features">
                            <span class="feature-tag">โ ุชุง 3 ุนฺฉุณ ุงุณุชุงู</span>
                            <span class="feature-tag">โ ุญูุธ ูุญุชูุง</span>
                            <span class="feature-tag">โ ููุท ูุถุง/ููุฑ</span>
                        </div>
                        <a href="/services/style-transfer.html" onclick="event.stopPropagation();" style="display: inline-block; margin-top: 12px; color: #667eea; text-decoration: none; font-weight: 500; font-size: 0.9375rem;">ุงุทูุงุนุงุช ุจุดุชุฑ โ</a>
                    </a>
                </div>
            </section>
        </div>
    </div>

    <script src="/service-permission-check.js"></script>
    <script>
        // Check authentication on page load
        (function checkAuth() {
            const token = localStorage.getItem('supabase_token');
            const session = localStorage.getItem('supabase_session');

            console.log('๐ Auth check:', {
                hasToken: !!token,
                hasSession: !!session,
                currentPath: window.location.pathname
            });

            if (!token || !session) {
                console.log('โ๏ธ No auth credentials found - redirecting to login');
                // Clear any partial data
                localStorage.removeItem('supabase_token');
                localStorage.removeItem('supabase_session');
                window.location.replace('/auth');
                return;
            }
            console.log('โ User is authenticated');
        })();

        // Logout function
        function handleLogout() {
            console.log('๐ช Logging out...');
            localStorage.removeItem('supabase_token');
            localStorage.removeItem('supabase_session');
            window.location.replace('/auth');
        }

        // Add click handlers to service cards to check permissions
        document.addEventListener('DOMContentLoaded', function() {
            const serviceCards = document.querySelectorAll('.mode-card[href^="/"]');

            serviceCards.forEach(card => {
                const originalHref = card.getAttribute('href');

                // Extract service key from href (e.g., '/complete-outfit.html' -> 'complete-outfit')
                const match = originalHref.match(/\/([^.]+)\.html/);
                if (!match) return;

                const serviceKey = match[1];

                // Remove default href behavior
                card.removeAttribute('href');
                card.style.cursor = 'pointer';

                // Add click handler
                card.addEventListener('click', async function(e) {
                    e.preventDefault();

                    // Show loading state
                    const originalText = card.innerHTML;
                    card.style.opacity = '0.6';
                    card.style.pointerEvents = 'none';

                    try {
                        const accessInfo = await checkServiceAccess(serviceKey);

                        if (accessInfo.hasAccess) {
                            // User has access, navigate to service
                            window.location.href = originalHref;
                        } else {
                            // User doesn't have access, show upgrade modal
                            showUpgradeModal(accessInfo, serviceKey);
                        }
                    } catch (error) {
                        console.error('Error checking service access:', error);
                        // On error, allow navigation (fail open)
                        window.location.href = originalHref;
                    } finally {
                        // Restore card state
                        card.style.opacity = '1';
                        card.style.pointerEvents = 'auto';
                    }
                });
            });
        });
    </script>
</body>
</html>

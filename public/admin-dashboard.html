<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3Z17GE6LBS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3Z17GE6LBS');
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | AI Fashion Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/admin-style.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <circle cx="20" cy="20" r="18" fill="white" opacity="0.2"/>
                    <path d="M20 10 L12 18 L20 26 L28 18 Z" fill="white"/>
                    <circle cx="20" cy="20" r="3" fill="white"/>
                </svg>
                <span>Admin Panel</span>
            </div>
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            </button>
        </div>

        <div class="sidebar-nav-container" data-active-page="dashboard"></div>

        <div class="sidebar-footer">
            <button class="btn-logout" onclick="handleLogout()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                </svg>
                <span>Logout</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="page-header">
            <div class="header-left">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <div>
                    <h1>Dashboard Overview</h1>
                    <p>Welcome back! Here's what's happening today.</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-refresh" onclick="loadStats()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                    </svg>
                    Refresh
                </button>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Total Users</div>
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-change positive">+12% from last month</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon purple">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Premium Users</div>
                    <div class="stat-value" id="premiumUsers">0</div>
                    <div class="stat-change positive">+8% from last month</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon green">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <path d="m21 15-5-5L5 21"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Total Images</div>
                    <div class="stat-value" id="totalImages">0</div>
                    <div class="stat-change positive">+23% from last month</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon orange">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Today's Images</div>
                    <div class="stat-value" id="todayImages">0</div>
                    <div class="stat-change">Active now</div>
                </div>
            </div>
        </div>

        <!-- Activity Section -->
        <div class="content-section">
            <div class="section-header">
                <h2>Recent Activity</h2>
                <button class="btn-secondary" onclick="loadLogs()">View All</button>
            </div>
            <div class="activity-list" id="activityList">
                <div class="loading">Loading activity...</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="content-section">
            <div class="section-header">
                <h2>Quick Actions</h2>
            </div>
            <div class="quick-actions">
                <a href="/admin/users" class="action-card">
                    <div class="action-icon">üë•</div>
                    <div class="action-title">Manage Users</div>
                    <div class="action-desc">View and manage user accounts</div>
                </a>
                <a href="/admin/content" class="action-card">
                    <div class="action-icon">üì∏</div>
                    <div class="action-title">Upload Content</div>
                    <div class="action-desc">Add models and backgrounds</div>
                </a>
                <a href="/admin/analytics" class="action-card">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">View Analytics</div>
                    <div class="action-desc">Detailed usage statistics</div>
                </a>
            </div>
        </div>
    </main>

    <script src="/admin-menu.js"></script>
    <script src="/admin-common.js"></script>
    <script>
        // Load stats on page load
        async function loadStats() {
            try {
                const response = await fetchWithAuth('/api/admin/stats');
                const data = await response.json();

                if (data.success) {
                    document.getElementById('totalUsers').textContent = data.stats.totalUsers.toLocaleString();
                    document.getElementById('premiumUsers').textContent = data.stats.premiumUsers.toLocaleString();
                    document.getElementById('totalImages').textContent = data.stats.totalImages.toLocaleString();
                    document.getElementById('todayImages').textContent = data.stats.todayImages.toLocaleString();
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                showNotification('Failed to load statistics', 'error');
            }
        }

        async function loadLogs() {
            try {
                const response = await fetchWithAuth('/api/admin/logs?limit=10');
                const data = await response.json();

                const activityList = document.getElementById('activityList');

                if (data.success && data.logs.length > 0) {
                    activityList.innerHTML = data.logs.map(log => `
                        <div class="activity-item">
                            <div class="activity-icon">${getActionIcon(log.action_type)}</div>
                            <div class="activity-content">
                                <div class="activity-title">${log.description}</div>
                                <div class="activity-time">${formatDate(log.created_at)}</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    activityList.innerHTML = '<div class="empty-state">No recent activity</div>';
                }
            } catch (error) {
                console.error('Error loading logs:', error);
            }
        }

        function getActionIcon(actionType) {
            const icons = {
                'user_update': 'üë§',
                'content_upload': 'üì§',
                'content_delete': 'üóëÔ∏è',
                'user_create': '‚ûï',
                'system': '‚öôÔ∏è'
            };
            return icons[actionType] || 'üìù';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        // Initialize
        loadStats();
        loadLogs();
    </script>
</body>
</html>
